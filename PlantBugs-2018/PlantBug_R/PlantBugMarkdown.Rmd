---
title: "PlantBug_Markdown"
author: "MJL"
date: "10/24/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Plant bug network analyses Fall 2018
Our goals for this project are to:
 1. explore the network across the different Hemiptera species in the Museum database  
 2. better understand the geographical and phylogenetic patterns of these networks

### Load in necessary libraries for data analysis of Plant-Bug networks:  
 - ggplot2  
 - RColorBrewer  
 - ggthemes  
 - bipartite  
 - tidyverse
```{r message = FALSE, warning = FALSE}
library(ggplot2)
library(RColorBrewer)
library(ggthemes)
library(bipartite)
library(tidyverse)
```

### Load in necessary datasets
As of November 2018, we'll be using the "hostNetwork_copy.tsv" that Katja pulled and put together from the museum data (included in this package).
```{r}
# Read in data file and read as data frame.
data <- read.delim("hostNetwork_copy.tsv", header = TRUE)

# Create new columns for full species names of both the host species and the insect species.
data$host <- paste(data$h_genus, data$h_species)
data$insect <- paste(data$i_genus, data$i_species)



#new table with columns
#write.table(data, "collectionsConservationBio/temp-data/data.txt", na = "NA", row.names = FALSE, col = TRUE, append = FALSE, sep="\t", quote=FALSE)

#creating a sublist of data where host plants and host insects are redlisted
#subdata <- subset(data, redList == TRUE)
```

### 1. Creating webs and making calculations

#### _Webs and calculations with bipartite_
Here we're filtering the big dataset to host family level and then creating the interaction network/calculating network metrics using the package, bipartite. 

We focus on connectance, weighted connectance, interaction evenness, and nestedness.

```{r warning = FALSE}

### Write FOR-LOOP to do the following:
# 1. take groups of families (only those with n < 200?)
# 2. create interaction matrix
# 3. convert matrix to data frame
# 4. calculate matrix metrics
# 5. print in metric data frame
  # a. connectance
  # b. weighted connectance
  # c. interaction evenness
  # d. nestedness



### Starting here with the Elaeagnaceae family. There are 54 observations so it's a fairly small set of observations which Michelle's computer can handle.

# filter to Elaeagnaceae family
elaeagnaceae <- data %>%
  filter(h_family == "Elaeagnaceae") %>% 
  # selecting columns with only host, insect, host family, and number of times observed
  select(host, insect, h_family, coll_number_same_h)

# transform observation data frame into an network matrix array
ela_matrix <- frame2webs(elaeagnaceae, varnames = c("host", "insect", "h_family", "coll_number_same_h"), type.out = 'array')

# print the network matrix as a data frame
ela_web <- as.data.frame(ela_matrix)

# calculate connectance
ela_connectance <- networklevel(ela_web, index = 'connectance')
ela_connectance

# calculate weighted connectance
ela_weight_connectance <- networklevel(ela_web, index = 'weighted connectance')
ela_weight_connectance

# calculate interaction evenness
ela_even <- networklevel(ela_web, index = 'interaction evenness')
ela_even

# calcualte network nestedness
ela_nest <- networklevel(ela_web, index = 'nestedness')
ela_nest



### Next, we'll use the Euphorbiaceae family which has 207 observations. Slightly larger, but still manageable.

# filter to Euphorbiaceae family
euphorb <- data %>% 
  filter(h_family == "Euphorbiaceae") %>% 
  select(host, insect, h_family, coll_number_same_h)

# transform observation data frame into an network matrix array
eup_matrix <- frame2webs(euphorb, varnames = c("host", "insect", "h_family", "coll_number_same_h"), type.out = 'array')

# print the network matrix as a data frame
eup_web <- as.data.frame(eup_matrix)

# calculate connectance
eup_connectance <- networklevel(eup_web, index = 'connectance')
eup_connectance

# calculate weighted connectance
eup_weight_connectance <- networklevel(eup_web, index = 'weighted connectance')
eup_weight_connectance

# calculate interaction evenness
eup_even <- networklevel(eup_web, index = 'interaction evenness')
eup_even

# calcualte network nestedness
eup_nest <- networklevel(eup_web, index = 'nestedness')
eup_nest



### Much smaller subset here with Dennstaedtiaceae, with 16 observations

# filter to Dennstaedtiaceae family
den <- data %>%
  filter(h_family == "Dennstaedtiaceae") %>% 
  select(host, insect, h_family, coll_number_same_h)

# transform observation data frame into an network matrix array
den_matrix <- frame2webs(den, varnames = c("host", "insect", "h_family", "coll_number_same_h"), type.out = 'array')

# print the network matrix as a data frame
den_web <- as.data.frame(den_matrix)

# calculate connectance
den_connectance <- networklevel(den_web, index = 'connectance')
den_connectance

# calculate weighted connectance
den_weight_connectance <- networklevel(den_web, index = 'weighted connectance')
den_weight_connectance

# calculate interaction evenness
den_even <- networklevel(den_web, index = 'interaction evenness')
den_even

# calculate network nestedness
den_nest <- networklevel(den_web, index = 'nestedness')
den_nest



```

#### _Analyses of calculations_
Following the above network calculations, we are now going analyze general trends in network metrics. 

```{r}
# check normality of metric spreads
# basic correlation between each metric and family size
# any basic 
```

